<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <title>mat-dp</title>
</head>
<body>
<nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item">
            <img src="logo.png" height="28" width="70"/>
        </a>
    </div>

    <div class="navbar-menu is-active">
        <div class="navbar-start">
            <div class="navbar-item">
                <button class="button is-black is-inverted is-large pl-3 pr-3" style ="margin-left: 70px;margin-right: 70px;color: #FFBA67">
                    HOME
                </button>
            </div>
            <div class="navbar-item">
                <button class="button is-black is-inverted is-large pl-3 pr-3 " style ="margin-left: 70px;margin-right: 70px;color: #FFBA67">
                    ENERGY
                </button>
            </div>
            <div class="navbar-item">
                <button class="button is-black is-inverted is-large pl-3 pr-3" style ="margin-left: 70px;margin-right: 70px;color: #FFBA67">
                    MATERIAL
                </button>
            </div>
            <div class="navbar-item">
                <button class="button is-black is-inverted is-large pl-3 pr-3" style ="margin-left: 70px;margin-right: 70px;color: #FFBA67">
                    EMISSIONS
                </button>
            </div>
            <div class="navbar-item">
                <button class="button is-black is-inverted is-large pl-3 pr-3" style ="margin-left: 70px;margin-right: 70px;color: #FFBA67">
                    EMPLOYMENT
                </button>
            </div>
        </div>

        <div class="navbar-end">
            <div class="navbar-item">

                    <a>
                        <i class="fab fa-twitter" style ="color: #FFBA67"></i>
                    </a>

            </div>
            <div class="navbar-item">
                <a>
                    <i class="fab fa-instagram" style ="color: #FFBA67"></i>
                </a>
            </div>
            <div class="navbar-item">
                <a>
                    <i class="fab fa-github" style ="color: #FFBA67"></i>
                </a>
            </div>
        </div>


    </div>


</nav>
<hr class="rounded" style ="background-color: #96D4CC;height: 10px;margin-top: 0">
<div class="container">

    <div class="columns">

        <div class="column" style ="background-color: #DEE2D9">

            <br>

            <div class="box">
                <p>Welcome to MAT-dp, an
                interactive tool for exploring
                climate compatible futures
                for energy and transport
                systems in developing
                countries and their impact
                on material demand and
                industrial capacity
                </p>
            </div>

            <div class="field">
                <div class="level m-0">
                    <label class="label">Country</label>
                    <a id ="cicon" style = "color: black">
                        <i class="fas fa-info-circle"></i>
                    </a>
                </div>
                <div class="control is-expanded">
                    <div class="select is-fullwidth">
                        <select id="country" onchange="refreshCountry();">
                        </select>
                    </div>
                </div>
            </div>


            <div class="field">
                <div class="level m-0">
                    <label class="label">Scenario</label>
                    <a  id ="sicon" style = "color: black">
                        <i class="fas fa-info-circle"></i>
                    </a>
                </div>
                <div class="control is-expanded">
                    <div class="select is-fullwidth">
                        <select id="scenario" onchange="refreshChart()">

                        </select>
                    </div>
                </div>
            </div>
        </div>


        <div class="column is-four-fifths">
            <div class=container>
                <canvas id="testChart">
                </canvas>
            </div>


            <div class=container>
                <canvas id="barChart1">
                </canvas>
            </div>
            <div class=container>
                <canvas id="barChart2">
                </canvas>
            </div>
        </div>
    </div>
</div>
</div>

<div class ="modal" id="countrymodal">
    <div class="modal-background" id="cbg"></div>
    <div class = "modal-content has-background-white">
        <div class = "box">
            Select the country for which the climate data will be displayed.
        </div>
    </div>
</div>

<div class ="modal" id="scenariomodal">
    <div class="modal-background" id="sbg"></div>
    <div class = "modal-content has-background-white">
        <div class = "box">
            Select the scenario, which corresponds to a certain energy generation strategy.
        </div>
    </div>
</div>

<script>

    var emissions_year = {{ emissions_year |safe }};
    var emissions_tech = {{ emissions_tech |safe }};
    var emissions_mat = {{ emissions_mat |safe }};

    var options = Object.keys(emissions_year);

    var selectBoxCountry = document.getElementById('country');

    for (var i = 0, l = options.length; i < l; i++) {
        var option = options[i];
        selectBoxCountry.options.add(new Option(option, option));
    }

    var selectBoxScenario = document.getElementById('scenario');
    var lineChart = null;
    var barChart1 = null;
    var barChart2 = null;
    // https://www.w3schools.com/colors/colors_names.asp
    var errorColor = "rgba(255,99,132,0.5)"
    // Chart.defaults.global.defaultColor = errorColor;
    var colorMap = {
        "Mat": {
            "Aluminium": "AliceBlue",
            "Bentonite": "Beige",
            "Cast Iron": "DarkBlue",
            "Cement": "DarkGrey",
            "Ceramics": "Cornsilk",
            "Concrete": "DimGrey",
            "Copper": "SandyBrown",
            "Glass": "PowderBlue",
            "Plastic": "LawnGreen",
            "PVC": "GhostWhite",
            "Sand": "NavajoWhite",
            "Silicon": "MidnightBlue",
            "Steel": "LightSteelBlue"
        },
        "Tech": {

            "Biomass": "SaddleBrown",
            "Coal": "Black",
            "Gas": "PaleGreen",
            "Geothermal": "FireBrick",
            "Hydro": "DodgerBlue",
            "Oil": "GoldenRod",
            "Solar PV": "Yellow",
            "Wind (Offshore)": "SkyBlue"

        }

    }

    function refreshCountry() {
        var c = document.getElementById('country').value;
        var scenarios = Object.keys(emissions_year[c]);

        selectBoxScenario.options.length = 0;

        for (var i = 0, l = scenarios.length; i < l; i++) {
            var scenario = scenarios[i];
            selectBoxScenario.options.add(new Option(scenario, scenario));
        }
        refreshChart();
    }

    function refreshChart() {
        var c = document.getElementById('country').value;
        var s = document.getElementById('scenario').value;

        var mainChart = emissions_year[c][s];
        var labels = Object.keys(Object.values(mainChart)[0]).map(x => +x);

        var testChart = document.getElementById('testChart').getContext('2d');

        if (lineChart != null)
            lineChart.destroy();
        if (barChart1 != null)
            barChart1.destroy();
        if (barChart2 != null)
            barChart2.destroy();

        lineChart = new Chart(testChart, {
            type: 'line',
            data: {
                labels: labels,
                datasets: Object.entries(mainChart).map(([name, data]) => {
                    return {
                        label: name,
                        backgroundColor: colorMap["Tech"][name],
                        data: Object.values(data).map(x => +x)
                    }
                })
            },
            options: {
                title:  {
                    display: true,
                    text: 'GHG EMISSIONS FROM MATERIAL PRODUCTION'
                },
                legend: {
                    position: 'right'
                },
                scales: {
                    yAxes: [{
                        stacked: true,
                    }],
                    xAxes: [{
                    }]
                }
            }
        });

        var bar1 = document.getElementById('barChart1').getContext('2d');
        var bar1Labels = Object.keys(Object.values(emissions_tech[c][s])[0]);

        console.log(bar1Labels);


        barChart1 = new Chart(bar1, {
            type: 'horizontalBar',
            data: {
                labels: bar1Labels,
                datasets: Object.entries(emissions_tech[c][s]).map(([name, data]) => {
                    return {
                        label: name,
                        backgroundColor: colorMap["Mat"][name],
                        data: Object.values(data)
                    }
                })
            },

            options: {
                title:  {
                    display: true,
                    text: 'EMISSIONS BY TECHNOLOGY (2020-2050)'
                },
                legend: {
                    position: 'right'
                },
                scales: {
                    xAxes: [{
                        stacked: true,
                    }],
                    yAxes: [{
                        stacked: true
                    }]
                }
            }
        })

        var bar2 = document.getElementById('barChart2');
        var bar2Labels = Object.keys(emissions_mat[c][s]);

        console.log(bar2Labels);

        console.log(Object.values(emissions_mat[c][s]));

        barChart2 = new Chart(bar2, {
            type: 'horizontalBar',
            data: {
                labels: bar2Labels,
                datasets: [{
                    label: '',
                    backgroundColor: Object.keys(emissions_mat[c][s]).map(x => colorMap["Mat"][x]),
                    data: Object.values(emissions_mat[c][s])
                }]
            },
            options:{
                title:  {
                    display: true,
                    text: 'EMISSIONS BY MATERIAL (2020-2050)'
                },
                legend: {
                    display:false
                }
            }
        })

    }
    //modals
    var cicon = document.getElementById('cicon')
    var cmodal = document.getElementById('countrymodal');
    var cbg = document.getElementById('cbg');

    cicon.addEventListener('click',()=>{
        console.log('clicked');
        cmodal.classList.add('is-active')
    })
    cbg.addEventListener('click',()=>{
        cmodal.classList.remove('is-active')
    })

    var sicon = document.getElementById('sicon')
    var smodal = document.getElementById('scenariomodal');
    var sbg = document.getElementById('sbg');

    sicon.addEventListener('click',()=>{
        console.log('clicked');
        smodal.classList.add('is-active')
    })
    sbg.addEventListener('click',()=>{
        smodal.classList.remove('is-active')
    })


    refreshCountry();
    refreshChart();

</script>


</body>
</html>